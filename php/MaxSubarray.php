<?php 

class MaxSubarray {

    /**
     * LeetCode problem url = https://leetcode.com/problems/maximize-subarrays-after-removing-one-conflicting-pair/
     * @param Integer $n
     * @param Integer[][] $conflictingPairs
     * @return Integer
     */
    function maxSubarrays($n, $conflictingPairs) {
        $right = [];

        // Step 1: Preprocess conflicts, for each right end, store all lefts
        foreach ($conflictingPairs as [$a, $b]) {
            $maxV = max($a, $b);
            $minV = min($a, $b);
            $right[$maxV][] = $minV;
        }

        $result = 0;
        $left = [0, 0];  // [maxLeft, secondMaxLeft]
        $bonus = [];

        // Step 2: Sweep from 1 to n
        for ($r = 1; $r <= $n; $r++) {
            if (isset($right[$r])) {
                foreach ($right[$r] as $l) {
                    if ($l > $left[0]) {
                        $left[1] = $left[0];
                        $left[0] = $l;
                    } else if ($l > $left[1]) {
                        $left[1] = $l;
                    }
                }
            }
            $result += $r - $left[0];
            if (!isset($bonus[$left[0]])) {
                $bonus[$left[0]] = 0;
            }
            $bonus[$left[0]] += $left[0] - $left[1];
        }

        return $result + (empty($bonus) ? 0 : max($bonus));
    }
}

$msub = new MaxSubarray();

$n= 49248;
$arr= [[16791,23449],[42039,5200],[47088,4328],[33231,35723],[45935,47035],[20253,22365],[2488,26531],[12311,31059],[10198,36843],[1777,19680],[32596,26606],[33355,27754],[37836,42310],[693,20098],[29051,42464],[28659,18715],[44170,22556],[6983,32672],[39184,9172],[5560,23370],[46828,11047],[35254,36201],[32599,28635],[29148,28476],[17063,29727],[14836,19961],[44635,6435],[14894,5039],[20128,18570],[44384,24252],[18571,38234],[13776,31728],[11590,12285],[37139,27667],[29534,35821],[40065,27787],[15977,49089],[12425,23260],[30512,44711],[13780,7188],[4634,11208],[9434,21366],[20986,11294],[35021,36495],[33534,12776],[7029,27887],[30649,23985],[11752,16254],[29630,12025],[431,26679],[29911,10887],[29823,31985],[35312,18737],[24095,36480],[31099,10678],[40400,44236],[3309,48346],[45305,24180],[902,26412],[419,35103],[32419,37278],[8005,44308],[38310,22803],[12871,39866],[35591,17914],[32748,12209],[40888,24088],[44623,35270],[9242,38536],[26754,14941],[29458,13432],[31603,11170],[1437,18938],[36776,45567],[37632,21425],[41321,45802],[25044,32110],[14143,8428],[23056,13457],[551,5386],[3383,42096],[48502,45434],[12035,33578],[25264,43119],[34480,38551],[220,16995],[9988,11132],[41097,31597],[20785,9329],[1228,44640],[26744,11868],[43329,46828],[14210,10111],[19329,34380],[11725,32391],[5491,44210],[33999,38007],[29435,39751],[25368,14812],[25383,14466],[29320,4500],[1256,20648],[6027,31832],[2260,44817],[33662,36996],[424,21789],[11182,4556],[28198,31828],[9499,23984],[3092,14025],[27258,8213],[37112,45327],[26723,20094],[42841,27171],[34510,12220],[337,31328],[31839,11940],[33484,44206],[30799,3635],[4483,14169],[36191,34350],[31416,13244],[46379,18652],[22336,47568],[5214,887],[29263,31918],[2024,44280],[17450,28320],[29288,21314],[43057,30021],[8554,16034],[21834,7482],[49200,20175],[7805,40588],[5102,19850],[12325,12379],[47998,28645],[44478,17738],[33790,25198],[43592,24745],[48270,4605],[48692,14275],[18809,317],[13870,10515],[2234,38359],[3398,20581],[34031,9602],[12525,34],[8951,36730],[36018,4544],[43390,31371],[38929,29235],[29819,23092],[47891,8276],[17618,34271],[37357,46927],[5800,5107],[41373,27143],[39003,35232],[419,3001],[21936,46276],[9300,43894],[3891,750],[29305,19697],[34892,22028],[38772,31211],[38236,18575],[44210,44027],[6988,24529],[32857,46555],[6054,2122],[23758,46138],[41120,36708],[15124,20870],[26543,44352],[17096,10434],[12592,12349],[35337,34263],[25299,19959],[41244,2635],[30743,23813],[5504,29439],[11295,22400],[12492,38520],[28447,37985],[46885,19881],[38825,31228],[4154,4801],[14100,40730],[38865,39978],[28993,6094],[17469,5050],[35126,16696],[39053,30555],[27208,12820],[38143,7011],[11339,39139],[28694,19152],[4556,17599],[16931,41243],[7408,31142],[648,29276],[6459,2980],[8124,20356],[45386,494],[46295,9689],[775,2185],[4378,33708],[24349,666],[47438,2739],[8240,32575],[12385,14820],[36138,37158],[20940,26070],[45345,40365],[11818,21853],[15996,47629],[39045,44902],[8514,12797],[19199,13796],[40954,31443],[27126,42115],[30721,37470],[6290,44506],[37286,23915],[9007,23142],[12981,22682],[28341,23333],[114,11964],[2949,46126],[39486,37220],[28876,38991],[9165,40589],[12670,18007],[25657,4141],[34949,31642],[3645,6159],[22295,2999],[26367,10744],[23896,20829],[26004,43224],[26597,37637],[32220,10930],[23669,27331],[49052,3892],[15093,28361],[1100,45740],[47448,48780],[45856,36036],[16165,42953],[8168,44177],[13431,21142],[5733,11623],[11478,39434],[35161,3881],[36789,37914],[41016,42973],[19845,25820],[19794,18865],[32588,19489],[15084,2523],[15439,5371],[48843,35186],[28031,21592],[22608,21131],[14806,17733],[21215,12487],[28748,20869],[44810,41470],[14846,27873],[3112,6917],[31274,11741],[737,26038],[17999,11565],[40277,24112],[6871,35231],[11720,19534],[42692,5573],[23443,44282],[43158,8858],[46450,5783],[48446,28049],[30122,48890],[48880,13570],[10939,1111],[9665,13739],[17936,21295],[10577,34352],[30435,9184],[9170,2882],[46344,4152],[18982,38916],[8522,40979],[19978,11785],[35560,30182],[25684,7778],[22730,10520],[8671,28603],[44252,44423],[22610,18461],[9576,33178],[37763,38357],[23635,4752],[19845,26261],[47780,5462],[27410,28173],[7042,411],[19224,23158],[12362,38857],[26782,34501],[27227,40379],[47524,628],[17585,3483],[34062,28478],[10884,35669],[26025,4136],[26325,25113],[9588,18912],[45099,18643],[37088,30849],[4442,18544],[30128,8096],[30032,2572],[27591,31296],[36001,20015],[18008,39122],[40145,21169],[4586,25101],[31147,22403],[19195,42652],[27645,40756],[18223,43653],[25668,3199],[45878,37867],[9800,45222],[17806,11914],[15853,24538],[30291,42604],[38498,17701],[43514,32396],[25992,39183],[40159,2551],[754,40374],[12140,48916],[23147,48719],[23439,12737],[15826,25216],[13813,24496],[23134,336],[18775,5523],[33168,3058],[31791,7590],[17846,15073],[42536,46363],[45000,43807],[18998,41314],[14584,28759],[45027,14756],[46044,31977],[28500,49125],[36078,42367],[20427,1904],[32136,12795],[41112,43813],[10797,25629],[7466,46137],[32622,44108],[3174,15817],[1540,34751],[4547,11145],[16321,18746],[20952,1309],[6897,45343],[28518,19663],[36705,16821],[5049,19826],[17441,34841],[40985,45626],[6119,23558],[7990,13765],[27948,8607],[9252,37098],[931,24929],[24032,39814],[14888,25173],[26827,43058],[43152,40294],[29051,38304],[18313,34304],[44331,12580],[18073,29487],[4131,27956],[22644,29756],[27298,39699],[34207,44078],[26062,19548],[44602,43399],[37461,47716],[16481,32617],[33812,16594],[14454,47938],[5064,39598],[41498,47749],[1229,6591],[36115,994],[1724,29518],[27870,41643],[14427,47890],[40985,4371],[6851,20107],[24979,41277],[22344,38135],[18956,1279],[14357,3494],[13176,12927],[5024,18747],[5227,40116],[28748,19892],[18486,15192],[46236,14663],[48875,5061],[40549,33988],[1152,20899],[12683,11391],[45952,13053],[34029,8279],[21339,43680],[37338,33244],[44136,8150],[34042,10408],[27630,19591],[27564,29435],[30679,28262],[460,21996],[30516,42745],[48769,31973],[25543,13021],[47261,21718],[44030,12186],[4339,10463],[28500,26825],[11908,44464],[2179,10441],[511,30817],[18667,36601],[26555,8010],[4355,47697],[17290,25759],[38152,30230],[5483,22403],[37484,42570],[39495,12658],[6546,17646],[43839,4499],[14715,17173],[27976,35454],[24707,15841],[34406,15416],[9343,45271],[14995,36496],[39407,8022],[18921,45336],[22555,15849],[7655,28757],[9828,1559],[45092,838],[36058,7900],[5224,8046],[6762,46127],[7554,24915],[24522,35042],[20364,32796],[33910,12147],[28434,31089],[38298,9586],[2870,20809],[13620,32859],[45197,34938],[4542,25924],[4820,7779],[11639,41228],[2061,49174],[25151,39415],[39749,25406],[11206,41155],[45326,39433],[24182,6043],[8675,22401],[6264,45240],[16777,48662],[47509,21940],[35006,11352],[48747,896],[10784,38920],[5230,13874],[16568,49131],[26938,742],[6238,25409],[12603,43593],[33737,5130],[32229,36534],[9005,8277],[30582,5516],[29087,10066],[15093,47446],[44813,32742],[5772,11945],[36849,23347],[19523,25964],[40076,37606],[8336,36072],[39668,17017],[30671,41594],[27054,21801],[1760,34576],[23323,40264],[4695,34815],[33139,34839],[26088,29028],[18606,48456],[20153,33294],[14930,44026],[34234,18753],[30871,23491],[23706,5790],[7149,19254],[6534,46796],[16917,18128],[36391,36580],[2582,40214],[41874,26892],[19362,44382],[5456,33221],[6652,17434],[7034,12574],[37069,3863],[13302,30644],[44725,36158],[35671,42250],[3623,24367],[17711,37880],[3036,28145],[17724,43812],[6900,10986],[31474,24813],[41238,12912],[2229,35532],[2254,8201],[48714,6943],[37247,24624],[32548,20449],[14429,26635],[13539,17090],[44353,45596],[37138,41904],[37505,9819],[45101,44773],[25311,953],[8093,12505],[6200,37121],[17931,46588],[38725,18932],[38895,35416],[44176,23665],[12234,2474],[31030,8416],[15502,25996],[20766,42345],[26827,11522],[44463,3128],[48596,41508],[37567,7219],[15462,22259],[21094,45183],[21932,36107]];
print_r($msub->maxSubarrays($n,$arr));